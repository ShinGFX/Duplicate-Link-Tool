# パッチノート

## v1.1.0 (2025-11-20)

### 新機能

#### パス入力の強化
- **履歴機能**: 上下矢印キーでセッション中に入力したパスを再利用（最大50件保存）
- **Undo/Redo機能**: Ctrl+Z（元に戻す）、Ctrl+Y（やり直し）に対応
- **「αと同じ」チェックボックス**: βディレクトリに同じパスを自動入力し、同一フォルダ内での重複検出を簡単に実行
  - チェック時はβ入力欄が灰色で無効化

#### 検出結果の選択機能
- 検出結果リストに個別チェックボックスを追加
  - 個別クリックで選択/解除
  - Shift+クリックで範囲選択/範囲解除
  - ヘッダークリックで全選択/全解除
- 選択したアイテムのみをリンク化可能（選択なしの場合は警告表示）

#### リンク作成の柔軟性向上
- **相対パス/絶対パスの選択**: シンボリックリンクとショートカット作成時にパス形式を選択可能
  - 相対パスは自動計算され、異なるドライブ間では自動的に絶対パスにフォールバック
  - ログに作成形式を明記（例：「相対パス」「絶対パス」）
- **どちらを残すかの選択**: リンク化実行時に実体として残すディレクトリを選択可能
  - 「αを残す（β側をリンク化）」または「βを残す（α側をリンク化）」
  - 処理ロジックが動的に切り替わり、選択に応じた変換を実行

### UI/UX改善

#### 表記の統一と明確化
- ディレクトリ名称を「メイン」「比較」から「**α**」「**β**」に統一
- 検出結果ヘッダーに実際のフォルダ名を表示（「α」「β」の代わり）
- 判定結果列を「Reason」から「**判定内容**」に変更
- CSVヘッダーを「Main, Duplicate, Reason」から「**α, β, 判定内容**」に変更
- ディレクトリラベルから「(基準側)」「(比較側)」の括弧表記を削除

#### リンク情報表示の改善
- シンボリックリンク、ジャンクション、ハードリンク、ショートカットを個別に表示
- 表示順序をUI選択順に統一：**ショートカット → シンボリックリンク → ハードリンク → ジャンクション**
- 例：`リンク状況: ショートカット 3件, シンボリックリンク 2件, ハードリンク 4件, ジャンクション 1件`

#### レイアウトと操作性
- カラムヘッダークリック時の誤動作を修正（下のアイテムが選択されない）
- リンクパス形式選択をリンク種別の直下に配置
- 選択ボタンの順序を直感的に変更（相対パス → 絶対パス）

#### デフォルト設定の最適化
- リンク種別：シンボリックリンク → **ショートカット**
- パス形式：絶対パス → **相対パス**
- 残すファイル名：β側 → **α側**
- よりポータブルで安全な初期設定に変更

### パフォーマンスと品質

#### 同一フォルダ比較の最適化
- 同一ファイルパス同士の無意味な比較を除外（A.txt ⇔ A.txt）
- 重複ペアの逆順検出を防止（A ⇔ B を検出した場合、B ⇔ A は検出しない）
- 非重複数の計算ロジックを改善し、正確な統計を表示

#### セキュリティ強化
- `mklink`コマンド実行時に`shell=False`を使用（OSコマンドインジェクション対策）
- コマンドを文字列からリスト形式に変更し、安全性を向上

#### 文字エンコーディング
- ショートカット作成時にUTF-8 BOM付きエンコーディングを使用
- 絵文字や日本語を含むファイル名の文字化けを解消

#### コード品質
- デバッグ用ログを削除し、クリーンアップ
- 冗長な関数を削除・簡略化
- 未使用パラメータを削除
- 不要なファイルとディレクトリを整理

### 技術的変更

#### アーキテクチャ
- `HistoryEntry`クラスを新規作成（履歴・Undo/Redo機能を実装）
- Treeviewを3列から4列に拡張（選択列を追加）
- 選択状態管理機能を実装（`tree_selection_state`辞書）

#### リンク処理
- `create_link`関数に`use_relative_path`パラメータを追加
- `keep_side`パラメータによる動的な処理切り替えを実装
- ショートカット作成時に`WorkingDirectory`プロパティを正しく設定
- リンク検出ロジックを改善（シンボリックリンク/ジャンクション/ハードリンクを正確に区別）

#### その他
- PowerShellスクリプト実行時のエンコーディングをUTF-8 BOMに統一
- アイコンファイル名を`duplicate_link_tool.ico`に統一
- ウィンドウ初期化時の`update_idletasks()`を複数回実行してレイアウトを安定化

---

## v1.0.0 (初回リリース)

基本的な重複ファイル検出とリンク化機能を提供
- 2つのディレクトリ間での重複ファイル検出
- シンボリックリンク、ハードリンク、ジャンクション、ショートカットの作成
- リンクの実体化機能
- 実体化して圧縮機能
- ダークテーマUI


### 新機能
- **パス入力欄の履歴機能**: 上下矢印キーで起動セッション中に入力したパスを再利用できるようになりました（最大50件）
- **Undo/Redo機能**: パス入力欄でCtrl+Z（元に戻す）とCtrl+Y（やり直し）が使えるようになりました
- **αと同じパス自動入力**: βディレクトリの横に「αと同じ」チェックボックスを追加。チェックするとαディレクトリと同じパスが自動入力され、同一フォルダ内での重複検出が簡単になりました
  - チェック時はβディレクトリ入力欄が灰色表示で無効化されます
- **検出結果の選択機能**: 検出結果リストの左側にチェックボックスを追加
  - クリックで個別選択/解除
  - Shift+クリックで範囲選択/範囲解除
  - ヘッダーのチェックボックスで全選択/全解除
  - 選択したアイテムのみに対してリンク化操作を実行可能（選択なしの場合は警告を表示）
- **相対パス/絶対パスの選択機能**: シンボリックリンクとショートカット作成時に、ターゲットパスを相対パスまたは絶対パスで指定できるようになりました
  - **デフォルトは相対パス**（v1.1.0で変更）
  - 相対パスを選択すると、リンク元からターゲットへの相対パスが自動計算されます
  - 異なるドライブ間など相対パス化できない場合は自動的に絶対パスで作成されます
  - ハードリンクとジャンクションには適用されません（これらは常に絶対パスで動作します）
  - ログに「相対パス」または「絶対パス」の表示を追加し、どちらで作成されたか一目で確認可能
- **どちらを残すかの選択機能**: リンク化実行時にどちらのディレクトリを実体として残すかを選択できるようになりました
  - 「αを残す（β側をリンク化）」：α側を実体として残し、β側をリンクに変換
  - 「βを残す（α側をリンク化）」：β側を実体として残し、α側をリンクに変換
  - デフォルトは「αを残す」
  - リンク化処理のロジックが動的に切り替わり、選択に応じた処理を実行

### 改善
- **UI表記の改善**:
  - ディレクトリ名称を「メイン」「比較」から「α」「β」に変更し、混乱を防止
  - 「実体化して圧縮するディレクトリ」の番号を削除（1), 2)と連続的な関係ではないため）
  - 比較結果ヘッダーを「Main」「Duplicate」から「α」「β」に変更
  - 判定結果列のヘッダーを「Reason」から「判定内容」に変更
  - リンク作成後に残すファイル名の選択順序を変更：α側を左に配置しデフォルトに設定
  - CSVエクスポートのヘッダーを「Main, Duplicate, Reason」から「α, β, 判定内容」に変更
  - ディレクトリラベルから「(基準側)」「(比較側)」の括弧付き説明を削除
  - 検出結果リストのヘッダーに各ディレクトリのフォルダ名を表示（「α」「β」の代わりに実際のフォルダ名を表示）