# Duplicate Link Tool

![Duplicate Link Tool Screenshot](sample/v1.0.0.png)

Duplicate Link Tool は、2 つのフォルダを比較して重複ファイルを見つけ、重複側をショートカットやリンクに置き換えることでディスク容量を節約できる Windows 向けツールです。GUI での操作に対応し、高速かつ正確な重複ファイル検出が特徴で、以下のステップで判定を行います。

1. **ファイル名とサイズが同一** … その時点で同一ファイルとみなします。
2. **それ以外でサイズが一致した組み合わせ** … サイズが同一のファイル同士のSHA-256によるハッシュ比較を実施し、完全一致した場合に重複と判定します。

このハイブリッド方式により、不要なハッシュ計算を避けつつ精度を保てるため、大量のファイルでも軽快に処理できます。

## 主な機能

- 重複検出結果を一覧表示し、確認しながら処理を進められます。
- ショートカット／シンボリックリンク／ハードリンク／ジャンクションの作成に対応。
- 重複側のフォルダから、非重複ファイルをエクスプローラーで一覧表示可能。
- リンクを実体化して ZIP にまとめる補助機能も搭載。
- リンクの実体化のみも可能。
- 比較結果を `duplicate_report.csv` に出力し、操作ログを記録。

## 使い方

1. メイン側フォルダ（残したいデータ）と比較側フォルダ（重複削除したい側）を選択します。
2. 「重複を検出」ボタンでスキャンを実行すると、重複一覧が一覧に表示されます。
3. 「リンク化を実行」で、比較側にショートカット等を自動作成。比較側の元ファイルはショートカット作成後に削除されます。
4. 必要に応じて、非重複ファイルの確認やリンクの実体化を行ってください。

> **注意:** ショートカットやリンク作成には管理者権限が必要です。起動時に昇格ダイアログが表示されます。

## 動作環境

- Windows 10 以降（管理者権限が必要）
- Python 3.9 以上（ソースから実行する場合）
- PowerShell（ショートカット操作やリンク実体化に使用）

## 重複判定のアルゴリズム

前述の 2 段階判定を迅速に行うため、メイン側フォルダのメタデータを事前にインデックス化し、比較側はスレッドプールで並列処理します。サイズが一致した候補については、必要になった場合にのみ SHA-256 を計算することで無駄なハッシュ処理を最小限に抑えています。

## インストールと実行

### 1. リリース版

1. GitHub リリースページから最新の `DuplicateLinkTool.exe` をダウンロードします。
2. ファイルを右クリックし、「管理者として実行」を選択します。
3. 起動後は GUI の指示に従い、メインフォルダ（残す側）と比較フォルダ（リンク化する側）を選択してください。

> **注意:** リポジトリにはビルド済みの EXE は含まれていません。最新リリースをご利用ください。

### 2. ソースコードから実行

1. 任意のディレクトリでリポジトリをクローンします。
2. （任意）仮想環境を作成してアクティベートします。
3. 追加の外部パッケージは不要です。以下のコマンドで起動できます。

```powershell
python duplicate_link_tool_windows.py
```

管理者権限での再起動を避けたい場合は、実行前に環境変数 `DLTOOL_SKIP_ELEVATION=1` を設定してください。

```powershell
set DLTOOL_SKIP_ELEVATION=1
python duplicate_link_tool_windows.py
```

## 使い方の流れ

1. メイン側と比較側のフォルダを指定します。
2. 「重複を検出」を実行すると、重複ファイルが一覧に表示されます。
3. 必要に応じて、生成するリンク種別（ショートカット／シンボリックリンク／ハードリンク／ジャンクション）を選択します。
4. 「リンク化を実行」で比較側のファイルをリンクに置き換えます。置き換え後に元ファイルは削除されます。
5. 比較側に残った非重複ファイルを開く、またはリンクを実体化して ZIP で書き出すといった追加操作も可能です。

## 出力とログ

- `duplicate_report.csv`: 検出した重複の一覧（メイン側、比較側、判定理由）
- `link_tool_log_*.txt`: 主要な操作ログ
- `startup_debug.log`: 権限昇格や EXE 起動に関するデバッグログ

## EXE のビルド方法

プロジェクトに同梱されている PyInstaller 設定ファイル `DuplicateLinkTool.spec` を使用します。

1. PyInstaller をインストールします。

```powershell
pip install pyinstaller
```

2. プロジェクトのルートで以下を実行します。

```powershell
pyinstaller DuplicateLinkTool.spec
```

3. `dist/DuplicateLinkTool.exe` が生成されます。必要に応じて `version_info.txt` や `assets/duplicate_link_tool.ico` を調整してください。

## その他

- `zip_util.py`: リンクの実体化および ZIP 化に関連するユーティリティ群をまとめています。

## トラブルシューティング

- **管理者ダイアログが表示され続ける**: PowerShell の実行ポリシーや UAC 設定を確認してください。開発用途で権限昇格を無効にする場合は `DLTOOL_SKIP_ELEVATION=1` を設定します。
- **ショートカットの作成に失敗する**: PowerShell または Windows Script Host が無効化されていないか確認してください。
- **リンク先の実体化でエラーが出る**: リンク先が既に削除されている場合があります。ログに詳細が出力されます。

## 免責事項

本ツールは重複ファイルの削除やリンク化を自動で行います。重要データでの使用に先立ち、十分なバックアップを取得してください。利用に伴う損害について開発者は責任を負いません。
